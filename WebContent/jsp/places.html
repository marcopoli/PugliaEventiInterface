<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ========== Meta Tags ========== -->
    <meta charset="UTF-8">
    <meta name="description" content="Evento -Event Html Template">
    <meta name="keywords" content="Evento , Event , Html, Template">
    <meta name="author" content="ColorLib">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- ========== Title ========== -->
    <title> Luoghi - Event Html Template</title>
    <!-- ========== Favicon Ico ========== -->
    <!--<link rel="icon" href="fav.ico">-->
    <!-- ========== STYLESHEETS ========== -->
    <!-- Bootstrap CSS -->
    <!--<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap2-toggle.min.css" rel="stylesheet">-->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fonts Icon CSS -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/et-line.css" rel="stylesheet">
    <link href="assets/css/ionicons.min.css" rel="stylesheet">
    <!-- Carousel CSS -->
    <link href="assets/css/owl.carousel.min.css" rel="stylesheet">
    <link href="assets/css/owl.theme.default.min.css" rel="stylesheet">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <!-- Custom styles for this template -->
    <link href="assets/css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/smoothness/jquery-ui.css">
    
    <link href="assets/css/spinner.css" rel="stylesheet">

	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />


</head>

<body onload="loadAllPlaces();"> 
<div class="loader">
    <div class="loader-outter"></div>
    <div class="loader-inner"></div>
</div>

<!--header start here -->
<header class="header navbar fixed-top navbar-expand-md">
    <div class="container">
        <a class="navbar-brand logo" href="#">
            <img src="assets/img/logo.png" alt="Evento"/>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#headernav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="lnr lnr-text-align-right"></span>
        </button>
        <div class="collapse navbar-collapse flex-sm-row-reverse" id="headernav">
            <ul class=" nav navbar-nav menu">
                <li class="nav-item">
                    <a class="nav-link active" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="profile.html" >Personal Page</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="events.html" >Eventi</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="#" >Luoghi</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="recommender.html" >Suggerimenti</a>
                </li>
            </ul>
        </div>
    </div>
</header>
<!--header end here-->

<!--page title section-->
<section class="inner_cover parallax-window" data-parallax="scroll" data-image-src="assets/img/bg/bg-img.png">
    <div class="overlay_dark"></div>
    <div class="container">
        <div class="row justify-content-center align-items-center">
            <div class="col-12">
                <div class="inner_cover_content">
                    <h3>
                       Tutte le location sul nostro territorio!
                    </h3>
                </div>
            </div>
        </div>

        <div class="breadcrumbs">
            <ul>
                <li><a href="#">Home</a>  |   </li>
                <li><span>Luoghi</span></li>
            </ul>
        </div>
    </div>
</section>
<!--page title section end-->


<!--events section -->
<section class="pt100 pb100">
    <div class="container">
    
    	<div class="card text-white bg-danger d-none" id="firstConfigHelp">
		  <div class="card-body">
		    <h5 class="card-title text-white">ATTENZIONE: Effettua la tua prima configurazione del profilo!</h5>
		    <p class="card-text text-white">Per permetterci di offrirti dei suggerimenti sugli eventi è necessario che tu ci fornisca un insieme di luoghi che hai già visitato, indicandoci
		    anche il contesto in cui ti trovavi al momento della visita (stato emotivo e compagnia).</p>
		    <p class="card-text text-white">Utilizza i filtri e segui le istruzioni più sotto per selezionare correttamente i luoghi.</p>
		  </div>
		</div>
		<div class="border border-danger" style="margin-top:5px; margin-bottom:15px;"></div>
    
    	<div>
  			<h5>Filtra i punti di interesse</h5>
  			<!--Nome evento:&nbsp;&nbsp;<input type="text" id="nome" width="50px" nome ="nome" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
			<!--  <form id="cercaEventi" name = "cercaEventi" enctype='multipart/form-data'> -->
  			<form>
  				<div class="form-group form-inline">
					<label for="nomeLuogo" class="col-sm-2 col-form-label">Nome del luogo </label>
					<div class="col-sm-4"><input type="text" class="form-control" id="nomeLuogo" name="nomeLuogo"  nome ="nomeLuogo"/></div>
				</div>
				<div class="form-group form-inline">
					<label for="comune" class="col-sm-2 col-form-label">Città in cui cercare </label>
					<div class="col-sm-4"><input type="text" class="form-control" id="comune" name="comune"  nome ="comune"/></div>
				</div>
				<!--  <div class="form-group form-inline">
					<label for="slider" class="col-sm-2 col-form-label">Raggio di ricerca </label>
					<div class="col-sm-4"><span id="slider" style="width:100px;display:inline-block"></span>&nbsp;&nbsp;&nbsp;&nbsp;<strong><span id="slider-value">10</span>&nbsp;km</strong></div>
				</div> -->
				<div class="form-group form-inline">
  					<label class="form-check-label col-sm-4" for="checkPlacesWithEvents">Mostra solo le location con eventi programmati</label>
  					<input class="form-check-input" type="checkbox" value="" id="checkPlacesWithEvents">	
				</div>
				<div class="form-group form-inline">
  					<label class="form-check-label col-sm-4" for="checkOnlyRatedPlaces">Mostra solo le location già visitate</label>
  					<input class="form-check-input" type="checkbox" value="" id="checkOnlyRatedPlaces">	
				</div>
	    		<div class="form-group">
	    			<a  class=" btn btn-primary btn-rounded mb-2" style="color:white;" onclick="loadAllPlaces();">Cerca locations</a>
	    		</div>
  			</form>
		</div>
		
    	<div class="border border-danger" style="margin-top:5px; margin-bottom:15px;"></div>
    	<div id ="waiting"></div>


		<div style="display: inline-block; padding-right:15px;" id="listPlaceholder"><h1>Punti di interesse</h1></div>
		<div style="display: inline-block;"><h3 id="counterPlaces"></h3></div>
		
		<div class="card text-white bg-danger d-none col-sm-6 mx-auto text-center" id="placePickerHelp">
			<div class="card-body">
				<span class="card-text text-white">Seleziona <b><span id="nSelect"></span></b> luoghi che hai visitato nel contesto: <b><span id="targetContext"></span></b></span>		
			</div>
		</div>


<div id ="placesContainer" name ="placesContainer">
</div>
   <ul id="pagination-demo" class="pagination-sm"></ul>
</div>
</section>
<!--event section end -->


<!--footer start -->
<footer>
    <div class="container">
        <div class="row justify-content-center">

            <div class="col-md-4 col-12">
                <div class="footer_box">
                    <div class="footer_header">
                        <div class="footer_logo">
                            <img src="assets/img/logo.png" alt="evento">
                        </div>
                    </div>
                    <div class="footer_box_body">
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. In rhoncus massa nec gravida tempus. Integer iaculis in aazzzCurabitur a pulvinar nunc. Maecenas laoreet finibus lectus, at volutpat ligula euismod.
                        </p>
                        <ul class="footer_social">
                            <li>
                                <a href="#"><i class="ion-social-pinterest"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-social-facebook"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-social-twitter"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-social-dribbble"></i></a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-social-instagram"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-4">
                <div class="footer_box">
                    <div class="footer_header">
                        <h4 class="footer_title">
                            instagram
                        </h4>
                    </div>
                    <div class="footer_box_body">
                        <ul class="instagram_list">
                            <li>
                                <a href="#">
                                    <img src="assets/img/cleander/c1.png" alt="instagram">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="assets/img/cleander/c2.png" alt="instagram">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="assets/img/cleander/c3.png" alt="instagram">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="assets/img/cleander/c3.png" alt="instagram">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="assets/img/cleander/c2.png" alt="instagram">
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    <img src="assets/img/cleander/c1.png" alt="instagram">
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-4">
                <div class="footer_box">
                    <div class="footer_header">
                        <h4 class="footer_title">
                            subscribe to our newsletter
                        </h4>
                    </div>
                    <div class="footer_box_body">
                        <div class="newsletter_form">
                            <input type="email" class="form-control" placeholder="E-Mail here">
                            <button class="btn btn-rounded btn-block btn-primary">SUBSCRIBE</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
<div class="copyright_footer">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 col-12">
                <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
            </div>
            <div class="col-12 col-md-6 ">
                <ul class="footer_menu">
                    <li>
                        <a href="#">Home</a>
                    </li>
                    <li>
                        <a href="#">Speakers</a>
                    </li>
                    <li>
                        <a href="#">Events</a>
                    </li>
                    <li>
                        <a href="#">News</a>
                    </li>
                    <li>
                        <a href="#">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!--footer end -->

<!-- jquery -->
<script src="assets/js/jquery.min.js"></script>
<!-- bootstrap -->
<script src="assets/js/popper.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/waypoints.min.js"></script>


<!--slick carousel -->
<script src="assets/js/owl.carousel.min.js"></script>
<!--parallax -->
<script src="assets/js/parallax.min.js"></script>
<!--Counter up -->
<script src="assets/js/jquery.counterup.min.js"></script>
<!--Counter down -->
<script src="assets/js/jquery.countdown.min.js"></script>
<!-- WOW JS -->
<script src="assets/js/wow.min.js"></script>
<!-- Custom js -->
<script src="assets/js/custom/main.js"></script>


<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twbs-pagination/1.4.2/jquery.twbsPagination.js"></script>


<!-- Date picker -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

<!-- AngularJS -->
<!--  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script> -->
	
<!-- Custom js - Functions and constants -->
<script src="assets/js/custom/constants.js"></script>
<script src="assets/js/custom/utils.js"></script> 
	
<script>

var n_select = 0;
var contextString = "";
var isFirstConfig = false;
var targetMood = "";
var targetCompanionship = "";
var ancoraDaInserire = 0;

$.holdReady(true);
checkConfigIsDone();



function checkConfigIsDone(){
$.ajax({
    type: 'post',
    url: DJANGO_API_ADDR+'getRatings/',
    data:{
    	'username': sessionStorage.getItem('userPugliaEvent'),
    },
    success: function (response) {
    	if (!response.first_config_done){
    		//show first config stuff
    		isFirstConfig = true;
    		$("#firstConfigHelp").removeClass('d-none');
    		$("#placePickerHelp").removeClass('d-none');
    		placePicker(response);
    		//callback();
    		refreshContextLabels();
    	}
    	else{
    		$("#firstConfigHelp").addClass('d-none');
    		$("#placePickerHelp").addClass('d-none');
    		//loadPagePlaces(page);
    	}
    	$.holdReady(false);	
    },
    error: function(e) {
      var je = JSON.parse(e.responseText);
       alert("ko");
    }
});
}

function placePicker(data){
	nAngryAloneToSelect = MIN_CONTEXT_PLACES - data.n_angry_alone;
	nAngryFriendsToSelect = MIN_CONTEXT_PLACES - data.n_angry_withFriends;
	nJoyfulAloneToSelect = MIN_CONTEXT_PLACES - data.n_joyful_alone;
	nJoyfulFriendsToSelect = MIN_CONTEXT_PLACES - data.n_joyful_withFriends;
	nSadAloneToSelect = MIN_CONTEXT_PLACES - data.n_sad_alone;
	nSadFriendsToSelect = MIN_CONTEXT_PLACES - data.n_sad_withFriends;
	
	ancoraDaInserire = nAngryAloneToSelect + nAngryFriendsToSelect + nJoyfulAloneToSelect + nJoyfulFriendsToSelect + nSadAloneToSelect + nSadFriendsToSelect;
	
	if (nAngryAloneToSelect > 0){
		//document.getElementById("nSelect").innerHTMl = nAngryAloneToSelect;
		//document.getElementById("actualContext").innerHTMl = "Arrabbiato, Da solo";
		n_select = nAngryAloneToSelect;
		contextString = "Arrabbiato, Da solo";
		targetMood= "angry";
		targetCompanionship="alone";
		console.log("placepicker:" + contextString + "  " +n_select);
		ancoraDaInserire--;
		return;
	}
	if (nAngryFriendsToSelect > 0){
		n_select = nAngryFriendsToSelect;
		contextString = "Arrabbiato, In compagnia";
		targetMood= "angry";
		targetCompanionship="withFriends";
		ancoraDaInserire--;
		return;
	}
	if (nJoyfulAloneToSelect > 0){
		n_select = nJoyfulAloneToSelect;
		contextString = "Felice, Da solo";
		targetMood= "joyful";
		targetCompanionship="alone";
		ancoraDaInserire--;
		return;
	}
	if (nJoyfulFriendsToSelect > 0){
		n_select = nJoyfulFriendsToSelect;
		contextString = "Felice, In compagnia";
		targetMood= "joyful";
		targetCompanionship="withFriends";
		ancoraDaInserire--;
		return;
	}
	if (nSadAloneToSelect > 0){
		n_select = nSadAloneToSelect;
		contextString = "Trieste, Da solo";
		targetMood= "sad";
		targetCompanionship="alone";
		ancoraDaInserire--;
		return;
	}
	if (nSadFriendsToSelect > 0){
		n_select = nSadFriendsToSelect;
		contextString = "Trieste, In compagnia";
		targetMood= "sad";
		targetCompanionship="withFriends";
		ancoraDaInserire--;
		return;
	}
	
	/*if(nAngryAloneToSelect <= 0 && nAngryFriendsToSelect <= 0 && nJoyfulAloneToSelect <= 0 && nJoyfulFriendsToSelect <= 0 && nSadAloneToSelect <= 0 && nSadFriendsToSelect <= 0){
		window.location.reload();
		
	}*/
	
	
}

function refreshContextLabels(){
	$("#targetContext").html(contextString);
	$("#nSelect").html(n_select);
	//console.log("print labels: " + contextString + "  " +n_select);
}


$(document).ready(function(){ 
	document.getElementById("comune").value = sessionStorage.getItem('userLocation');
	$("body").tooltip({ selector: '[data-toggle=tooltip]' });
	refreshContextLabels();

});



$("#slider").slider(
{
            value:10,
            min: 0,
            max: 30,
            step: 5,
            slide: function( event, ui ) {
                $( "#slider-value" ).html( ui.value );
            }
}
);


function loadAllPlaces(){
	document.getElementById("waiting").innerHTML ='<div style="text-align:center;"><div class="lds-dual-ring"></div><div><h5>Recupero dati in corso..</h5></div></div>';
	document.getElementById("placesContainer").innerHTML ="";
	document.getElementById("listPlaceholder").innerHTML ="";
	document.getElementById("counterPlaces").innerHTML =""
	var onlyPlacesWithEvents = 0;
	var onlyRatedPlaces = 0;
	if (document.getElementById("checkPlacesWithEvents").checked) onlyPlacesWithEvents = 1;
	if (document.getElementById("checkOnlyRatedPlaces").checked) onlyRatedPlaces = 1;
	
    $.ajax({
        type: 'post',
        url: DJANGO_API_ADDR+'getAllPlaces/',
        data:{
        	'username': sessionStorage.getItem('userPugliaEvent'),
        	'location':document.getElementsByName('comune')[0].value,
        	'luogo':document.getElementsByName('nomeLuogo')[0].value,
        	//'range':document.getElementById("slider-value").innerHTML,
        	'range':0,
        	'only-with-events': onlyPlacesWithEvents,
        	'only-rated-places': onlyRatedPlaces
        },
        success: function (response) {
        	allPlaces = response;
        	document.getElementById("waiting").innerHTML = "";
        	makePages(allPlaces.length, 1);
        	document.getElementById("listPlaceholder").innerHTML= "<h1>Punti di interesse </h1>";
        	document.getElementById("counterPlaces").innerHTML= " ("+ allPlaces.length + " trovati)";
        	loadPagePlaces(1);
        	
        },
        error: function(e) {
          var je = JSON.parse(e.responseText);
           alert("ko");
        }
    });
}

function loadPagePlaces(page){
	var placeColumns = 2;
	var elements = 20;
	var pageOffset =  ((page*elements)-elements);
	$("#placesContainer").html("");
	var row = 0;
	for (var i = pageOffset; i < Math.min((page*elements), allPlaces.length); i++){
		if (i % placeColumns == 0){
			document.getElementById('placesContainer').innerHTML =   document.getElementById('placesContainer').innerHTML + "<div class = 'row' id='placerow" + parseInt(i/placeColumns) + "'></div>";
		}
        printPlaces(allPlaces[i],i, i, "placerow"+parseInt(i/placeColumns));
      }
}

$('input[id=checkOnlyRatedPlaces]').change(function(){
    if($(this).is(':checked')) {
    	$('input[id=comune]').prop('disabled', true);
    	$('input[id=checkPlacesWithEvents]').prop('disabled', true);
    	$('input[id=checkPlacesWithEvents]').prop('checked', false);
    } else {
    	console.log("is unchecked");
    	$('input[id=comune]').prop('disabled', false);
    	$('input[id=checkPlacesWithEvents]').prop('disabled', false);
    }
});

</script>

</body>
</html>
